<div class="card mt-4 col">
  <div class="card-header">
    <h4>Income & Expenditure</h4>
  </div>

  <div class="card-body">
    <date-range-chooser
      [initialDateRangeEnum]="DateRangeEnum.LAST_QUARTER"
      (dateDangeChosen)="dateRangeChanged($event)"
    ></date-range-chooser>

    <div class="row justify-content-between mt-2">
      <div class="col-sm-6">
        <div>
          <span
            *ngIf="loading"
            class="spinner-border spinner-border-lg align-center"
          ></span>
        </div>
      </div>
    </div>

    <div class="row class">
      <div class="col-sm">
        <table class="table table-striped table-hover table-responsive w-auto">
          <thead>
            <tr *ngIf="data && data.range">
              <th></th>
              <th>
                {{ data.range.currentPeriodStart }} -
                {{ data.range.currentPeriodEnd }}
              </th>
              <th>
                {{ data.range.previousPeriodStart }} -
                {{ data.range.previousPeriodEnd }}
              </th>
              <th>Change</th>
            </tr>
          </thead>
          <tbody *ngIf="data && data.income">
            <tr>
              <th></th>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <tr *ngFor="let item of data.income.rows">
              <td>{{ item.displayName }}</td>
              <td class="text-end">
                {{ Math.round(item.currentValue) | number: "1.0-0" }}
              </td>
              <td class="text-end">
                {{ Math.round(item.previousValue) | number: "1.0-0" }}
              </td>
              <td class="text-end">
                {{
                  Math.round(item.currentValue - item.previousValue)
                    | number: "1.0-0"
                }}
              </td>
            </tr>
            <tr>
              <th>Total Income</th>
              <td class="text-end border-tb">
                {{ Math.round(data.income.currentValue) | number: "1.0-0" }}
              </td>
              <td class="text-end border-tb">
                {{ Math.round(data.income.previousValue) | number: "1.0-0" }}
              </td>
              <td class="text-end border-tb">
                {{
                  Math.round(
                    data.income.currentValue - data.income.previousValue
                  ) | number: "1.0-0"
                }}
              </td>
            </tr>
            <tr>
              <td>Cost of Goods Sold</td>
              <td class="text-end">
                {{ data.cogs.currentValue | number: "1.0-0" }}
              </td>
              <td class="text-end">
                {{ data.cogs.previousValue | number: "1.0-0" }}
              </td>
              <td class="text-end">
                {{
                  data.cogs.previousValue - data.cogs.currentValue
                    | number: "1.0-0"
                }}
              </td>
            </tr>
            <tr>
              <th>Gross Profit</th>
              <td class="text-end border-tb2">
                {{ data.grossprofit.currentValue | number: "1.0-0" }}
              </td>
              <td class="text-end border-tb2">
                {{ data.grossprofit.previousValue | number: "1.0-0" }}
              </td>
              <td class="text-end border-tb2">
                {{
                  data.grossprofit.previousValue - data.grossprofit.currentValue
                    | number: "1.0-0"
                }}
              </td>
            </tr>
            <ng-container *ngFor="let item of data.expenses.rows">
              <tr [ngbCollapse]="!isExpensesExpanded">
                <td>&nbsp;&nbsp;{{ item.displayName }}</td>
                <td class="text-end">
                  {{ item.currentValue | number: "1.0-0" }}
                </td>
                <td class="text-end">
                  {{ item.previousValue | number: "1.0-0" }}
                </td>
                <td class="text-end">
                  {{ item.previousValue - item.currentValue | number: "1.0-0" }}
                </td>
              </tr>
            </ng-container>
            <tr>
              <th>
                <span
                  *ngIf="!isExpensesExpanded"
                  type="button"
                  class="ml-1"
                  (click)="isExpensesExpanded = !isExpensesExpanded"
                  [attr.aria-expanded]="!isExpensesExpanded"
                  aria-controls="collapseExample"
                  >+</span
                >
                <span
                  *ngIf="isExpensesExpanded"
                  type="button"
                  class="ml-1"
                  (click)="isExpensesExpanded = !isExpensesExpanded"
                  [attr.aria-expanded]="!isExpensesExpanded"
                  aria-controls="collapseExample"
                  >-</span
                >
                Expenses
              </th>
              <td class="text-end border-tb">
                {{ data.expenses.currentValue | number: "1.0-0" }}
              </td>
              <td class="text-end border-tb">
                {{ data.expenses.previousValue | number: "1.0-0" }}
              </td>
              <td class="text-end border-tb">
                {{
                  data.expenses.previousValue - data.expenses.currentValue
                    | number: "1.0-0"
                }}
              </td>
            </tr>
            <tr>
              <th>Net operating Income</th>
              <td class="text-end">
                {{ data.netoperatingincome.currentValue | number: "1.0-0" }}
              </td>
              <td class="text-end">
                {{ data.netoperatingincome.previousValue | number: "1.0-0" }}
              </td>
              <td class="text-end">
                {{
                  data.netoperatingincome.previousValue -
                    data.netoperatingincome.currentValue | number: "1.0-0"
                }}
              </td>
            </tr>
            <ng-container *ngIf="data.otherincome && data.otherincome.rows">
              <tr
                [ngbCollapse]="!isOtherIncomeCollapsed"
                *ngFor="let item of data.otherincome.rows"
              >
                <td>&nbsp;&nbsp;{{ item.displayName }}</td>
                <td class="text-end">
                  {{ Math.round(item.currentValue) | number: "1.0-0" }}
                </td>
                <td class="text-end">
                  {{ Math.round(item.previousValue) | number: "1.0-0" }}
                </td>
                <td class="text-end">
                  {{
                    Math.round(item.previousValue - item.currentValue)
                      | number: "1.0-0"
                  }}
                </td>
              </tr>
            </ng-container>
            <ng-container *ngIf="data.otherexpenses && data.otherexpenses.rows">
              <tr
                [ngbCollapse]="!isOtherIncomeCollapsed"
                *ngFor="let item of data.otherexpenses.rows"
              >
                <td>&nbsp;&nbsp;{{ item.displayName }}</td>
                <td class="text-end">
                  {{ Math.round(-item.currentValue) | number: "1.0-0" }}
                </td>
                <td class="text-end">
                  {{ Math.round(-item.previousValue) | number: "1.0-0" }}
                </td>
                <td class="text-end">
                  {{
                    Math.round(item.currentValue - item.previousValue)
                      | number: "1.0-0"
                  }}
                </td>
              </tr>
            </ng-container>
            <tr *ngIf="data.netotherincome">
              <td>
                <span
                  *ngIf="!isOtherIncomeCollapsed"
                  type="button"
                  class="ml-1"
                  (click)="isOtherIncomeCollapsed = !isOtherIncomeCollapsed"
                  [attr.aria-expanded]="!isOtherIncomeCollapsed"
                  aria-controls="collapseExample"
                  >+</span
                >
                <span
                  *ngIf="isOtherIncomeCollapsed"
                  type="button"
                  class="ml-1"
                  (click)="isOtherIncomeCollapsed = !isOtherIncomeCollapsed"
                  [attr.aria-expanded]="!isOtherIncomeCollapsed"
                  aria-controls="collapseExample"
                  >-</span
                >
                Net Other Income
              </td>
              <td class="text-end border-tb">
                {{ data.netotherincome.currentValue | number: "1.0-0" }}
              </td>
              <td class="text-end border-tb">
                {{ data.netotherincome.previousValue | number: "1.0-0" }}
              </td>
              <td class="text-end border-tb">
                {{
                  data.netotherincome.previousValue -
                    data.netotherincome.currentValue | number: "1.0-0"
                }}
              </td>
            </tr>
            <tr>
              <th>Net Income</th>
              <td class="text-end border-bb">
                {{ data.netincome.currentValue | number: "1.0-0" }}
              </td>
              <td class="text-end border-bb">
                {{ data.netincome.previousValue | number: "1.0-0" }}
              </td>
              <td class="text-end border-bb">
                {{
                  data.netincome.previousValue - data.netincome.currentValue
                    | number: "1.0-0"
                }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
