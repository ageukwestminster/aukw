<div class="card mt-4 col">
  <div class="card-header">
    <h4>Income & Expenditure</h4>
  </div>
  <div class="row justify-content-between mt-2">
    <div class="col-sm-6">
      <div>
        <span
          *ngIf="loading"
          class="spinner-border spinner-border-lg align-center"
        ></span>
      </div>
    </div>
  </div>
  <div class="card-body">
    <form [formGroup]="form">
      <div class="row mb-4">
        <div class="col-sm">
          <div class="input-group">
            <span class="input-group-text col-4" id="period-label">Date</span>
            <select
              class="form-control"
              id="selectList"
              #selectList
              (change)="onDateRangeChanged(selectList.value)"
              formControlName="dateRange"
            >
              <option value="null">Any</option>
              <option
                *ngFor="let dtRng of DateRange | keyvalue: originalOrder"
                value="{{ dtRng.value }}"
              >
                {{ dtRng.value }}
              </option>
            </select>
          </div>
        </div>
        <div class="col-sm-auto p-0">From</div>
        <div class="col-sm-auto">
          <div class="input-group col p-0 mb-1">
            <input
              class="form-control"
              placeholder="Start"
              name="dp1"
              ngbDatepicker
              #d1="ngbDatepicker"
              formControlName="startDate"
              id="inputStartDate"
              placement="bottom"
            />
            <div class="input-group-append">
              <button
                class="btn btn-outline-secondary"
                (click)="d1.toggle()"
                type="button"
              >
                <i class="far fa-calendar-alt"></i>
              </button>
            </div>
          </div>
        </div>
        <div class="col-sm-auto p-0">To</div>
        <div class="col-sm-auto">
          <div class="input-group col p-0 mb-1">
            <input
              class="form-control"
              placeholder="End"
              name="dp2"
              ngbDatepicker
              #d2="ngbDatepicker"
              formControlName="endDate"
              id="inputEndDate"
              placement="bottom"
            />
            <div class="input-group-append">
              <button
                class="btn btn-outline-secondary"
                (click)="d2.toggle()"
                type="button"
              >
                <i class="far fa-calendar-alt"></i>
              </button>
            </div>
          </div>
        </div>
        <div class="col-sm-auto p-0">
          <a class="btn btn-link" (click)="onRefreshPressed()">Refresh</a>
        </div>
      </div>

      <div class="row class">
        <div class="col-sm">
          <table
            class="table table-striped table-hover table-responsive w-auto"
          >
            <thead>
              <tr *ngIf="data && data.period && data.period[0]">
                <th></th>
                <th>{{ data.period[0] }}</th>
                <th>{{ data.period[1] }}</th>
                <th>Change</th>
              </tr>
            </thead>
            <tbody *ngIf="data && data.income">
              <tr>
                <th></th>
                <td></td>
                <td></td>
                <td></td>
              </tr>
              <tr *ngFor="let item of data.income.rows">
                <td>{{ item.name }}</td>
                <td class="text-end">{{ Math.round(item.value[0]) | number: "1.0-0" }}</td>
                <td class="text-end">{{ Math.round(item.value[1]) | number: "1.0-0" }}</td>
                <td class="text-end">
                  {{ Math.round(item.value[1] - item.value[0]) | number: "1.0-0" }}
                </td>
              </tr>
              <tr>
                <th>Total Income</th>
                <td class="text-end border-tb">
                  {{ Math.round(data.income.rows[0].value[0]) | number: "1.0-0" }}
                </td>
                <td class="text-end border-tb">
                  {{ Math.round(data.income.rows[0].value[1]) | number: "1.0-0" }}
                </td>
                <td class="text-end border-tb">
                  {{
                    Math.round(data.income.rows[0].value[1] - data.income.rows[0].value[0])
                      | number: "1.0-0"
                  }}
                </td>
              </tr>
              <tr>
                <td>Cost of Goods Sold</td>
                <td class="text-end">
                  {{ data.cogs.total[0] | number: "1.0-0" }}
                </td>
                <td class="text-end">
                  {{ data.cogs.total[1] | number: "1.0-0" }}
                </td>
                <td class="text-end">
                  {{
                    data.cogs.total[1] - data.cogs.total[0] | number: "1.0-0"
                  }}
                </td>
              </tr>
              <tr>
                <th>Gross Profit</th>
                <td class="text-end border-tb2">
                  {{ data.grossprofit.total[0] | number: "1.0-0" }}
                </td>
                <td class="text-end border-tb2">
                  {{ data.grossprofit.total[1] | number: "1.0-0" }}
                </td>
                <td class="text-end border-tb2">
                  {{
                    data.grossprofit.total[1] - data.grossprofit.total[0]
                      | number: "1.0-0"
                  }}
                </td>
              </tr>
              <tr>
                <td>
                  Expenses
                </td>
                <td>    </td>
                <td></td>
                <td></td>
              </tr>
              <ng-container *ngFor="let item of data.expenses.rows" >
                <tr [ngbCollapse]="!isExpensesCollapsed">
                  <td>&nbsp;&nbsp;{{ item.name }}</td>
                  <td class="text-end">{{ item.value[0] | number: "1.0-0" }}</td>
                  <td class="text-end">{{ item.value[1] | number: "1.0-0" }}</td>
                  <td class="text-end">
                    {{ item.value[1] - item.value[0] | number: "1.0-0" }}
                  </td>
                </tr>
              </ng-container>
              <tr>
                <th>
                  <span 
                  type="button"
                  class="ml-1"
                  (click)="isExpensesCollapsed = !isExpensesCollapsed"
                  [attr.aria-expanded]="!isExpensesCollapsed"
                  aria-controls="collapseExample"
                >+</span>
                Total Expenses
              </th>
                <td class="text-end border-tb">
                  {{ data.expenses.total[0] | number: "1.0-0" }}
                </td>
                <td class="text-end border-tb">
                  {{ data.expenses.total[1] | number: "1.0-0" }}
                </td>
                <td class="text-end border-tb">
                  {{
                    data.expenses.total[1] - data.expenses.total[0]
                      | number: "1.0-0"
                  }}
                </td>
              </tr>
              <tr>
                <th>Net operating Income</th>
                <td class="text-end">
                  {{ data.netoperatingincome.total[0] | number: "1.0-0" }}
                </td>
                <td class="text-end">
                  {{ data.netoperatingincome.total[1] | number: "1.0-0" }}
                </td>
                <td class="text-end">
                  {{
                    data.netoperatingincome.total[1] -
                      data.netoperatingincome.total[0] | number: "1.0-0"
                  }}
                </td>
              </tr>
              <ng-container *ngFor="let item of data.otherincome.rows" >
                <tr [ngbCollapse]="!isOtherIncomeCollapsed">
                  <td>&nbsp;&nbsp;{{ item.name }}</td>
                  <td class="text-end">{{ Math.round(item.value[0]) | number: "1.0-0" }}</td>
                  <td class="text-end">{{ Math.round(item.value[1]) | number: "1.0-0" }}</td>
                  <td class="text-end">
                    {{ Math.round(item.value[1] - item.value[0]) | number: "1.0-0" }}
                  </td>
                </tr>
              </ng-container>
              <ng-container *ngFor="let item of data.otherexpenses.rows" >
                <tr [ngbCollapse]="!isOtherIncomeCollapsed">
                  <td>&nbsp;&nbsp;{{ item.name }}</td>
                  <td class="text-end">{{ Math.round(-item.value[0]) | number: "1.0-0" }}</td>
                  <td class="text-end">{{ Math.round(-item.value[1]) | number: "1.0-0" }}</td>
                  <td class="text-end">
                    {{ Math.round(item.value[0] - item.value[1]) | number: "1.0-0" }}
                  </td>
                </tr>
              </ng-container>
              <tr>
                <th>
                  <span 
                    type="button"
                    class="ml-1"
                    (click)="isOtherIncomeCollapsed = !isOtherIncomeCollapsed"
                    [attr.aria-expanded]="!isOtherIncomeCollapsed"
                    aria-controls="collapseExample"
                  >+</span>
                  Net Other Income
                </th>
                <td class="text-end border-tb">
                  {{ data.netotherincome.total[0] | number: "1.0-0" }}
                </td>
                <td class="text-end border-tb">
                  {{ data.netotherincome.total[1] | number: "1.0-0" }}
                </td>
                <td class="text-end border-tb">
                  {{
                    data.netotherincome.total[1] - data.netotherincome.total[0]
                      | number: "1.0-0"
                  }}
                </td>
              </tr>
              <tr>
                <th>Net Income</th>
                <td class="text-end border-bb">
                  {{ data.netincome.total[0] | number: "1.0-0" }}
                </td>
                <td class="text-end border-bb">
                  {{ data.netincome.total[1] | number: "1.0-0" }}
                </td>
                <td class="text-end border-bb">
                  {{
                    data.netincome.total[1] - data.netincome.total[0]
                      | number: "1.0-0"
                  }}
                </td>
              </tr>
              <tr *ngIf="!data">
                <td colspan="4" class="text-center">
                  <span
                    class="spinner-border spinner-border-lg align-center"
                  ></span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </form>
  </div>
</div>
