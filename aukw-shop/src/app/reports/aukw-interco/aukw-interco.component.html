<div class="card mt-4 col">
  <div class="card-header d-flex justify-content-between">
    <div class="col-sm">
      @if (enterprises) {
        <div>
          <h4>AUKW Intercompany Account</h4>
          <small>From Enterprises QuickBooks file</small>
        </div>
      }
      @if (!enterprises) {
        <div>
          <h4>AUEW Intercompany Account</h4>
          <small>From Charity QuickBooks file</small>
        </div>
      }
    </div>
    <div>
      <button type="button" routerLink="/reports" class="btn btn-outline-dark">
        Close &times;
      </button>
    </div>
  </div>
  <div class="row justify-content-between mt-2">
    <div class="col-sm-2">
      <div>
        <div>
          @if (loading) {
            <span
              class="spinner-border spinner-border-lg align-center"
            ></span>
          }
        </div>
        @if (data && data.length) {
          <div class="m-2">
            Found {{ data && data.length }} entries
          </div>
        }
      </div>
      @if (user.isAdmin) {
        <div>
          <div class="form-check m-2">
            <input
              type="checkbox"
              class="form-check-input"
              [checked]="enterprises"
              (click)="checkboxClick()"
              id="checkboxEnterprises"
              />
              <label class="form-check-label" for="checkboxEnterprises">
                Enterprises
              </label>
            </div>
          </div>
        }
        <div>
          <button class="btn btn-primary mx-2" (click)="exportToCSV()">
            Export To CSV
          </button>
        </div>
      </div>

      <div class="col-sm-10">
        <div class="card m-2">
          <interco-trade
            [existingTrade]="selectedTrade"
            [enterprises]="enterprises">
          </interco-trade>
        </div>
      </div>
    </div>
    <div class="card-body" >
      <date-range-chooser
        class="p-2 col-sm-9"
        [initialDateRangeEnum]="INITIALDATERANGE"
        (dateDangeChosen)="onDateRangeChanged($event)"
      ></date-range-chooser>

      <div class="row">
        <div class="col-sm">
          <table class="table table-striped table-hover table-responsive w-auto">
            <thead>
              <tr>
                <th>Date</th>
                <th class="d-none d-md-table-cell">Type</th>
                <th class="d-none d-md-table-cell">
                  <!-- Tooltip must be on element inside header, not header itself-->
                  <!-- From https://stackoverflow.com/a/48324991/6941165 -->
                  <div ngbTooltip="Name of charity shop employee.">Name</div>
                </th>
                <th class="d-none d-sm-table-cell">Memo</th>
                <th>
                  <div ngbTooltip="QBO Reconciliation status">Rec</div>
                </th>
                <th>
                  <div ngbTooltip="Matching transaction exists in other QBO file.">M</div>
                </th>
                <th class="d-none d-lg-table-cell">Increase</th>
                <th class="d-none d-lg-table-cell">Decrease</th>
                <th class="d-table-cell d-lg-none">Amount</th>
                <th>Balance</th>
              </tr>
            </thead>
            <tbody>
              @for (item of data; track item) {
                <tr (click)="onRowClick(item)">
                  <th>
                    <span class="text-dark">{{ item.date }}</span>
                  </th>
                  <td class="d-none d-md-table-cell text-start">
                    {{ item.type.value }}
                  </td>
                  <td class="d-none d-md-table-cell text-start">
                    {{ item.emp_name.value }}
                  </td>
                  <td class="d-none d-sm-table-cell text-start">
                    {{ item.memo }}
                  </td>
                  <td class="text-center">{{ item.is_cleared }}</td>
                  <td class="text-center">@if (item.matching_txn) {
                    <i class="fas fa-check"></i>
                  }</td>
                  <td class="d-none d-lg-table-cell text-end">
                    {{ formatPositiveNumber(item.amount) | number: "1.2-2" }}
                  </td>
                  <td class="d-none d-lg-table-cell text-end">
                    {{ formatNegativeNumber(item.amount) | number: "1.2-2" }}
                  </td>
                  <td class="d-table-cell d-lg-none">
                    {{ item.amount | number: "1.2-2" }}
                  </td>
                  <td class="text-end">{{ item.balance | number: "1.2-2" }}</td>
                </tr>
              }
              @if (!data) {
                <tr>
                  <td colspan="7" class="text-center">
                    <span
                      class="spinner-border spinner-border-lg align-center"
                    ></span>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
