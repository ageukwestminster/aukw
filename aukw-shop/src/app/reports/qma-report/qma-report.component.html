<div class="card mt-4 col">
  <div class="card-header">
    <h4>Quarterly QMA Report Summary Data</h4>
    <small>From Enterprises QuickBooks file</small>
  </div>
  <date-range-chooser
    [initialDateRangeEnum]="DateRangeEnum.LAST_QUARTER"
    (dateDangeChosen)="dateRangeChanged($event)"
  ></date-range-chooser>

  <div class="row justify-content-between mt-2">
    <div class="col-sm-6">
      <div>
        <span
          *ngIf="loading"
          class="spinner-border spinner-border-lg align-center"
        ></span>
      </div>
    </div>
  </div>

  <div class="row class">
    <div class="col-sm">
      <table class="table table-striped table-hover table-responsive w-auto">
        <thead>
          <tr *ngIf="data && data.range">
            <th></th>
            <td>
              {{ data.range.previousPeriodStart | date: "dd/MM/yy" }} -
              {{ data.range.previousPeriodEnd | date: "dd/MM/yy" }}
            </td>
            <td>
              {{ data.range.currentPeriodStart | date: "dd/MM/yy" }} -
              {{ data.range.currentPeriodEnd | date: "dd/MM/yy" }}
            </td>
            <th class="text-end">&nbsp;&nbsp;&nbsp;&nbsp;Change</th>
          </tr>
        </thead>
        <tbody *ngIf="data">
          <tr></tr>
          <tr>
            <th>
              <span class="text-dark">Total in-store Income*</span>
            </th>
            <td class="text-end">
              {{
                data.income.previousValue + data.donations.previousValue
                  | number: "1.2-2"
              }}
            </td>
            <td class="text-end">
              {{
                data.income.currentValue + data.donations.currentValue
                  | number: "1.2-2"
              }}
            </td>
            <td class="d-none d-lg-table-cell text-end">
              {{
                data.income.currentValue +
                  data.donations.currentValue -
                  data.income.previousValue -
                  data.donations.previousValue | number: "1.2-2"
              }}
            </td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>
              <span
                >Total in-store income from customer sales</span
              >
            </th>
            <td class="text-end">
              {{ data.instorecustomersales.previousValue | number: "1.2-2" }}
            </td>
            <td class="text-end">
              {{ data.instorecustomersales.currentValue | number: "1.2-2" }}
            </td>
            <td class="d-none d-lg-table-cell text-end">
              {{
                data.instorecustomersales.currentValue -
                  data.instorecustomersales.previousValue | number: "1.2-2"
              }}
            </td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <th>Breakdown</th>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>Donated goods income</td>
            <td class="text-end">
              {{ data.instorecustomersales.previousValue | number: "1.2-2" }}
            </td>
            <td class="text-end">
              {{ data.instorecustomersales.currentValue | number: "1.2-2" }}
            </td>
            <td class="d-none d-lg-table-cell text-end">
              {{
                data.instorecustomersales.currentValue -
                  data.instorecustomersales.previousValue | number: "1.2-2"
              }}
            </td>
          </tr>
          <tr>
            <td>Rag income</td>
            <td class="text-end">
              {{ data.ragging.previousValue | number: "1.2-2" }}
            </td>
            <td class="text-end">
              {{ data.ragging.currentValue | number: "1.2-2" }}
            </td>
            <td class="d-none d-lg-table-cell text-end">
              {{
                data.ragging.currentValue -
                  data.ragging.previousValue | number: "1.2-2"
              }}
            </td>
          </tr>
          <tr>
            <td>Cash Donations</td>
            <td class="text-end">
              {{ data.donations.previousValue | number: "1.2-2" }}
            </td>
            <td class="text-end">
              {{ data.donations.currentValue | number: "1.2-2" }}
            </td>
            <td class="d-none d-lg-table-cell text-end">
              {{
                data.donations.currentValue -
                  data.donations.previousValue | number: "1.2-2"
              }}
            </td>
          </tr>
          <tr>
            <td>Miscellaneous Income</td>
            <td class="text-end">
              {{ data.miscellaneousincome.previousValue | number: "1.2-2" }}
            </td>
            <td class="text-end">
              {{ data.miscellaneousincome.currentValue | number: "1.2-2" }}
            </td>
            <td class="d-none d-lg-table-cell text-end">
              {{
                data.miscellaneousincome.currentValue -
                  data.miscellaneousincome.previousValue | number: "1.2-2"
              }}
            </td>
          </tr>
          <tr>
            <th>
              <span class="text-dark"
                >Total Income</span
              >
            </th>
            <td class="text-end border-tb">
              {{
                data.income.previousValue + data.donations.previousValue
                  | number: "1.2-2"
              }}
            </td>
            <td class="text-end border-tb">
              {{
                data.income.currentValue + data.donations.currentValue
                  | number: "1.2-2"
              }}
            </td>
            <td class="d-none d-lg-table-cell text-end border-tb">
              {{
                data.income.currentValue +
                  data.donations.currentValue -
                  data.income.previousValue -
                  data.donations.previousValue | number: "1.2-2"
              }}
            </td>
          </tr>
        </tbody>
      </table>
      <small id="notes"
        >*Total in-store income covers income generated by all open shops in
        your retail chain (including donated goods + charity shop collections
        (i.e. rag) + bought-in goods excluding VAT + Gift Aid tax reclaims +
        cash donations + misc income).
      </small>
    </div>
  </div>
</div>
