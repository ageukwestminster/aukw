<h1>Project Allocations</h1>
<router-outlet></router-outlet>
<div class="w-100 border-bottom border-secondary mb-3"></div>
<div class="mb-3">
      <button
      type="button"
      class="btn btn-primary btn-lg me-3"
      [disabled]="loading"
      (click)="reload()"
    >
      Reload
    </button>
      <button
      type="submit"
      [disabled]="loading"
      class="btn btn-primary btn-lg me-3"
      aria-label="Create Transaction in Quickbooks"
    >
      Save
    </button>
    <button
      type="button"
      class="btn btn-outline-dark btn-lg"
      (click)="goBack()"
    >
      Cancel
    </button>

  </div>



<table class="table table-sm table-responsive">
  <thead>
    <tr>
      <th>Actions</th>
      <th class="text-start">Name</th>
      <th>Projects</th>
    </tr>
  </thead>
  <tbody>
    @for (
      employee of employeesWithAllocations;
      track employee.payrollNumber;
      let i = $index
    ) {
      <!-- If the employee was not in the last payrun then flag their table row-->
      <tr
        [ngClass]="{ 'table-warning': !inPayrun.get(employee.payrollNumber) }"
      >
        <td>
          <!-- Button to remove line from table -->
          <a class="btn p-0 me-2" (click)="onEditEmployee(employee)"
            ><i class="fa-solid fa-pen-to-square"></i
          ></a>
          <a class="btn p-0" (click)="onRemoveEmployee(employee)"
            ><i class="fa-solid fa-trash"></i
          ></a>
        </td>
        <td class="text-start">{{ employee.name }}</td>
        <td class="text-start">
          <div class="row">
            @for (
              projectName of employeeProjects(employee);
              track projectName
            ) {
              <div class="col-sm-auto project-name me-2">{{ projectName }}</div>
            }
          </div>
        </td>
      </tr>
    }
    @if (!allocations || !allocations.length) {
      <tr></tr>
      <tr>
        <td colspan="3" class="text-center">
          <span class="spinner-border spinner-border-lg align-center"></span>
        </td>
      </tr>
    }
  </tbody>
</table>
